<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlas Travel ‚Äî Service & Visa Hub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #dbeafe;
            --secondary: #7c3aed;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --neutral: #6b7280;
            --neutral-light: #f3f4f6;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e5e7eb;
            --text: #111827;
            --text-light: #6b7280;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 12px;
            --radius-sm: 8px;
            --sidebar-width: 260px;
            --header-height: 80px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 1.25rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background-color: rgba(37, 99, 235, 0.9);
            height: var(--header-height);
        }

        .header-title h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .header-title p {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .role-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 13px;
            backdrop-filter: blur(4px);
        }

        .role-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .role-badge.admin {
            background: var(--primary);
            color: white;
        }

        .role-badge.service {
            background: var(--secondary);
            color: white;
        }

        .role-badge.visa {
            background: var(--success);
            color: white;
        }

        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            transition: all 0.2s ease;
            backdrop-filter: blur(4px);
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .notification-badge {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
        }

        /* Main Layout */
        .app-container {
            display: flex;
            min-height: calc(100vh - var(--header-height));
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--card);
            border-right: 1px solid var(--border);
            padding: 1.5rem 0;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 1.5rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .sidebar-logo-text {
            font-size: 18px;
            font-weight: 700;
        }

        .sidebar-logo-sub {
            font-size: 11px;
            opacity: 0.7;
        }

        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 1.5rem;
            color: var(--text);
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--neutral-light);
            border-left-color: var(--primary);
        }

        .nav-item.active {
            background: var(--primary-light);
            color: var(--primary);
            border-left-color: var(--primary);
            font-weight: 600;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
            font-weight: 600;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
        }

        .user-role {
            font-size: 12px;
            color: var(--text-light);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background: var(--bg);
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--text);
        }

        .page-subtitle {
            font-size: 1rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .action-bar {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Cards */
        .card {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 1px solid var(--border);
            backdrop-filter: blur(8px);
            background-color: rgba(255, 255, 255, 0.9);
            margin-bottom: 1.5rem;
        }

        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(to right, #f9fafb, #f3f4f6);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text);
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            display: flex;
            align-items: center;
            padding: 1.5rem;
            gap: 1rem;
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .stat-icon.primary {
            background: var(--primary-light);
            color: var(--primary);
        }

        .stat-icon.success {
            background: #d1fae5;
            color: var(--success);
        }

        .stat-icon.warning {
            background: #fef3c7;
            color: var(--warning);
        }

        .stat-icon.secondary {
            background: #ede9fe;
            color: var(--secondary);
        }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: 1.875rem;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .stat-change {
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Chart */
        .chart-container {
            height: 200px;
            display: flex;
            align-items: flex-end;
            gap: 12px;
            padding: 20px 0;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .chart-bar:hover {
            opacity: 0.8;
        }

        .chart-bar-label {
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: var(--text-light);
            white-space: nowrap;
        }

        .chart-bar-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            font-weight: 600;
            color: var(--text);
        }

        /* Activity Log */
        .activity-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: 13px;
            color: var(--text);
        }

        .activity-time {
            font-size: 11px;
            color: var(--text-light);
            margin-top: 2px;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 16px;
            background: var(--neutral-light);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
            color: var(--text);
            text-align: left;
        }

        .quick-action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Three Column Layout */
        .three-column {
            display: grid;
            grid-template-columns: 280px 1fr 360px;
            gap: 1.5rem;
            height: calc(100vh - var(--header-height) - 6rem);
        }

        @media (max-width: 1400px) {
            .three-column {
                grid-template-columns: 240px 1fr 300px;
            }
        }

        @media (max-width: 1100px) {
            .three-column {
                grid-template-columns: 1fr;
                height: auto;
            }
        }

        .column {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .column-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            background: linear-gradient(to right, #f9fafb, #f3f4f6);
        }

        .column-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
        }

        .column-body {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        /* List Items */
        .list-item {
            padding: 12px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 8px;
            border: 1px solid transparent;
        }

        .list-item:hover {
            background: var(--neutral-light);
            border-color: var(--border);
        }

        .list-item.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .list-item-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .list-item-sub {
            font-size: 12px;
            color: var(--text-light);
        }

        .list-item.active .list-item-sub {
            color: rgba(255, 255, 255, 0.8);
        }

        /* Pilgrim List Item */
        .pilgrim-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 8px;
            border: 1px solid transparent;
        }

        .pilgrim-item:hover {
            background: var(--neutral-light);
            border-color: var(--border);
        }

        .pilgrim-item.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .pilgrim-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: var(--primary);
            flex-shrink: 0;
            font-weight: 600;
        }

        .pilgrim-item.active .pilgrim-avatar {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .pilgrim-info {
            flex: 1;
            min-width: 0;
        }

        .pilgrim-name {
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .pilgrim-passport {
            font-size: 12px;
            color: var(--text-light);
        }

        .pilgrim-item.active .pilgrim-passport {
            color: rgba(255, 255, 255, 0.8);
        }

        /* Pilgrim Card */
        .pilgrim-card-header {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .pilgrim-card-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 600;
        }

        .pilgrim-card-name {
            font-size: 18px;
            font-weight: 600;
        }

        .pilgrim-card-id {
            font-size: 13px;
            opacity: 0.8;
            margin-top: 2px;
        }

        .pilgrim-card-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 1200px) {
            .pilgrim-card-body {
                grid-template-columns: 1fr;
            }
        }

        .info-section {
            margin-bottom: 20px;
        }

        .info-section-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .info-label {
            font-size: 13px;
            color: var(--text-light);
        }

        .info-value {
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
        }

        .pilgrim-card-actions {
            padding: 16px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 500;
        }

        .badge-success { background: #d1fae5; color: var(--success); }
        .badge-warning { background: #fef3c7; color: var(--warning); }
        .badge-danger { background: #fee2e2; color: var(--danger); }
        .badge-primary { background: var(--primary-light); color: var(--primary); }
        .badge-secondary { background: #ede9fe; color: var(--secondary); }
        .badge-neutral { background: var(--neutral-light); color: var(--neutral); }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            white-space: nowrap;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--neutral-light);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #047857;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
        }

        .btn-outline:hover {
            background: var(--neutral-light);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-icon {
            padding: 8px;
            width: 36px;
            height: 36px;
        }

        .btn-block {
            width: 100%;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card);
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: var(--neutral-light);
        }

        td {
            font-size: 14px;
            color: var(--text);
        }

        tr:hover td {
            background: var(--neutral-light);
        }

        .table-actions {
            display: flex;
            gap: 8px;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text);
        }

        .form-hint {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .form-input, .form-select, .form-textarea {
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-size: 0.875rem;
            transition: all 0.2s;
            width: 100%;
            background: var(--card);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 520px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transform: scale(0.95) translateY(20px);
            transition: all 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(to right, #f9fafb, #f3f4f6);
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--neutral-light);
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--border);
            color: var(--text);
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            background: linear-gradient(to right, #f9fafb, #f3f4f6);
        }

        /* Calendar */
        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .calendar-month {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text);
            min-width: 200px;
            text-align: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-weekday {
            padding: 12px;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
        }

        .calendar-day {
            aspect-ratio: 1;
            min-height: 80px;
            padding: 8px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
        }

        .calendar-day:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .calendar-day.other-month {
            background: var(--neutral-light);
            color: var(--text-light);
        }

        .calendar-day.today {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .calendar-day-number {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .calendar-events {
            flex: 1;
            overflow: hidden;
        }

        .calendar-event {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .calendar-event.departure {
            background: var(--primary-light);
            color: var(--primary);
        }

        .calendar-event.arrival {
            background: #d1fae5;
            color: var(--success);
        }

        /* Settings */
        .settings-section {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
        }

        .settings-section-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(to right, #f9fafb, #f3f4f6);
        }

        .settings-section-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--primary);
        }

        .settings-section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text);
        }

        .settings-section-body {
            padding: 1.5rem;
        }

        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .setting-row:last-child {
            border-bottom: none;
        }

        .setting-info {
            flex: 1;
        }

        .setting-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
        }

        .setting-desc {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 2px;
        }

        /* Toggle Switch */
        .toggle {
            position: relative;
            width: 44px;
            height: 24px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border);
            border-radius: 24px;
            transition: all 0.3s ease;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle input:checked + .toggle-slider {
            background: var(--primary);
        }

        .toggle input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            padding: 14px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            max-width: 400px;
            animation: slideIn 0.3s ease;
            border-left: 4px solid var(--primary);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast-icon {
            font-size: 20px;
        }

        .toast-success { border-left-color: var(--success); }
        .toast-error { border-left-color: var(--danger); }
        .toast-warning { border-left-color: var(--warning); }
        .toast-info { border-left-color: var(--primary); }

        .toast-message {
            flex: 1;
            font-size: 14px;
            color: var(--text);
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 18px;
            color: var(--text-light);
            cursor: pointer;
            padding: 4px;
        }

        .toast-close:hover {
            color: var(--text);
        }

        /* Search Input */
        .search-input-wrapper {
            position: relative;
            width: 100%;
        }

        .search-input-wrapper input {
            padding-left: 36px;
            width: 100%;
        }

        .search-input-wrapper::before {
            content: "üîç";
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            color: var(--text-light);
            z-index: 1;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 14px;
        }

        /* Visa Status Chart */
        .visa-chart {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .visa-chart-item {
            flex: 1;
            text-align: center;
        }

        .visa-chart-bar {
            height: 8px;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .visa-chart-label {
            font-size: 12px;
            color: var(--text-light);
        }

        .visa-chart-value {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
                height: auto;
            }
            
            .header-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                position: fixed;
                top: var(--header-height);
                left: 0;
                height: calc(100vh - var(--header-height));
                z-index: 100;
                transform: translateX(-100%);
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .content-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .calendar-day {
                min-height: 60px;
            }
            
            .calendar-event {
                font-size: 8px;
            }
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            padding: 4px;
            background: var(--neutral-light);
            border-radius: var(--radius-sm);
            margin-bottom: 1.5rem;
        }

        .tab {
            flex: 1;
            padding: 10px 16px;
            text-align: center;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-light);
            transition: all 0.2s ease;
            border: none;
            background: transparent;
        }

        .tab:hover {
            color: var(--text);
        }

        .tab.active {
            background: var(--card);
            color: var(--primary);
            box-shadow: var(--shadow);
        }

        /* Progress Bar */
        .progress-bar {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Document List */
        .document-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--neutral-light);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
            border: 1px solid var(--border);
        }

        .document-icon {
            width: 40px;
            height: 40px;
            background: var(--card);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .document-info {
            flex: 1;
        }

        .document-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
        }

        .document-meta {
            font-size: 11px;
            color: var(--text-light);
        }

        /* OCR Status */
        .ocr-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .ocr-status.new {
            background: var(--neutral-light);
            color: var(--neutral);
        }

        .ocr-status.ocr_done {
            background: #fef3c7;
            color: var(--warning);
        }

        .ocr-status.checked {
            background: #d1fae5;
            color: var(--success);
        }

        /* File Input */
        .file-input-wrapper {
            position: relative;
            margin-bottom: 12px;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .file-input-label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 14px;
            background: var(--neutral-light);
            border: 2px dashed var(--border);
            border-radius: var(--radius-sm);
            font-size: 13px;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .file-input-label:hover {
            background: var(--border);
            border-color: var(--primary);
        }

        /* Help Text */
        .help-text {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 4px;
            line-height: 1.4;
        }

        /* Visa Status Badge */
        .visa-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 500;
        }

        .visa-status-badge.none {
            background: var(--neutral-light);
            color: var(--neutral);
        }

        .visa-status-badge.pending {
            background: #fef3c7;
            color: var(--warning);
        }

        .visa-status-badge.approved {
            background: #d1fae5;
            color: var(--success);
        }

        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
            padding: 8px;
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-title">
            <h1>Atlas Travel ‚Äî Service & Visa Hub</h1>
            <p>–°–µ—Ä–≤–∏—Å–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è ¬∑ –í–∏–∑–æ–≤—ã–π –∫–æ–Ω—Ç—É—Ä ¬∑ –ï–¥–∏–Ω–∞—è –±–∞–∑–∞ –ø–∞–ª–æ–º–Ω–∏–∫–æ–≤</p>
        </div>
        <div class="header-controls">
            <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
            <div class="role-selector">
                <span>–†–æ–ª—å:</span>
                <span class="role-badge admin" id="currentRole">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                <button class="header-btn" onclick="toggleRole()">üîÑ</button>
            </div>
            <button class="header-btn">
                üîî
                <span class="notification-badge"></span>
            </button>
            <button class="header-btn">‚ùì</button>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo-icon">‚úà</div>
                <div>
                    <div class="sidebar-logo-text">Atlas Travel</div>
                    <div class="sidebar-logo-sub">Service & Visa Hub</div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" onclick="showPage('dashboard', this); return false;">
                    <span class="nav-icon">üìä</span>
                    –î–∞—à–±–æ—Ä–¥
                </a>
                <a href="#" class="nav-item" onclick="showPage('groups', this); return false;">
                    <span class="nav-icon">üë•</span>
                    –ì—Ä—É–ø–ø—ã –∏ –ø–∞–ª–æ–º–Ω–∏–∫–∏
                </a>
                <a href="#" class="nav-item" onclick="showPage('templates', this); return false;">
                    <span class="nav-icon">üìÑ</span>
                    –®–∞–±–ª–æ–Ω—ã
                </a>
                <a href="#" class="nav-item" onclick="showPage('managers', this); return false;">
                    <span class="nav-icon">üë§</span>
                    –ú–µ–Ω–µ–¥–∂–µ—Ä—ã
                </a>
                <a href="#" class="nav-item" onclick="showPage('schedule', this); return false;">
                    <span class="nav-icon">üìÖ</span>
                    –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                </a>
                <a href="#" class="nav-item" onclick="showPage('settings', this); return false;">
                    <span class="nav-icon">‚öô</span>
                    –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">–ê–ö</div>
                    <div>
                        <div class="user-name">–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ö–æ–∑–ª–æ–≤</div>
                        <div class="user-role">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div class="page active" id="page-dashboard">
                <div class="content-header">
                    <div>
                        <h1 class="page-title">–î–∞—à–±–æ—Ä–¥</h1>
                        <p class="page-subtitle">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í–æ—Ç —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –≤–∞—à–∏–º–∏ –≥—Ä—É–ø–ø–∞–º–∏ –ø–∞–ª–æ–º–Ω–∏–∫–æ–≤</p>
                    </div>
                    <div class="action-bar">
                        <button class="btn btn-primary" onclick="openModal('groupModal')">
                            <span>üìÅ</span>
                            –ù–æ–≤–∞—è –≥—Ä—É–ø–ø–∞
                        </button>
                        <button class="btn btn-secondary" onclick="quickReport()">
                            <span>üìä</span>
                            –ë—ã—Å—Ç—Ä—ã–π –æ—Ç—á–µ—Ç
                        </button>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon primary">üë•</div>
                        <div class="stat-content">
                            <div class="stat-value" id="statTotalPilgrims">0</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –ø–∞–ª–æ–º–Ω–∏–∫–æ–≤</div>
                            <div class="stat-change positive">‚Üë +127 –∑–∞ –Ω–µ–¥–µ–ª—é</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon success">‚úì</div>
                        <div class="stat-content">
                            <div class="stat-value" id="statReady">0</div>
                            <div class="stat-label">–ì–æ—Ç–æ–≤–æ –∫ –≤—ã–ª–µ—Ç—É</div>
                            <div class="stat-change positive">71.5%</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon warning">‚è≥</div>
                        <div class="stat-content">
                            <div class="stat-value" id="statPending">0</div>
                            <div class="stat-label">–í –æ–∂–∏–¥–∞–Ω–∏–∏ –≤–∏–∑</div>
                            <div class="stat-change">22.8%</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon secondary">üìÖ</div>
                        <div class="stat-content">
                            <div class="stat-value" id="statUpcoming">0</div>
                            <div class="stat-label">–ë–ª–∏–∂–∞–π—à–∏–µ –≥—Ä—É–ø–ø—ã</div>
                            <div class="stat-change positive">+3 –Ω–æ–≤—ã–µ</div>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Grid -->
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" id="monthlyChart"></div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                        </div>
                        <div class="card-body">
                            <div class="quick-actions">
                                <button class="quick-action-btn" onclick="openModal('pilgrimModal')">
                                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–∞–ª–æ–º–Ω–∏–∫–∞
                                </button>
                                <button class="quick-action-btn" onclick="openModal('groupModal')">
                                    üìÅ –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É
                                </button>
                                <button class="quick-action-btn" onclick="showPage('templates', document.querySelector('.nav-item:nth-child(3)'))">
                                    üìÑ –®–∞–±–ª–æ–Ω—ã
                                </button>
                                <button class="quick-action-btn" onclick="showPage('schedule', document.querySelector('.nav-item:nth-child(5)'))">
                                    üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                                </button>
                            </div>

                            <div style="margin-top: 24px;">
                                <div class="info-section-title">–°—Ç–∞—Ç—É—Å –≤–∏–∑</div>
                                <div class="visa-chart">
                                    <div class="visa-chart-item">
                                        <div class="visa-chart-bar" style="background: var(--success);"></div>
                                        <div class="visa-chart-value" id="visaApprovedCount">0</div>
                                        <div class="visa-chart-label">–û–¥–æ–±—Ä–µ–Ω–æ</div>
                                    </div>
                                    <div class="visa-chart-item">
                                        <div class="visa-chart-bar" style="background: var(--warning);"></div>
                                        <div class="visa-chart-value" id="visaPendingCount">0</div>
                                        <div class="visa-chart-label">–í –æ–∂–∏–¥–∞–Ω–∏–∏</div>
                                    </div>
                                    <div class="visa-chart-item">
                                        <div class="visa-chart-bar" style="background: var(--neutral);"></div>
                                        <div class="visa-chart-value" id="visaNoneCount">0</div>
                                        <div class="visa-chart-label">–ù–µ—Ç –ø–æ–¥–∞—á–∏</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">–ñ—É—Ä–Ω–∞–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
                        <button class="btn btn-secondary btn-sm" onclick="showAllActivities()">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</button>
                    </div>
                    <div class="card-body">
                        <div class="activity-list" id="activityList"></div>
                    </div>
                </div>
            </div>

            <!-- Groups & Pilgrims Page -->
            <div class="page" id="page-groups">
                <div class="content-header">
                    <div>
                        <h1 class="page-title">–ì—Ä—É–ø–ø—ã –∏ –ø–∞–ª–æ–º–Ω–∏–∫–∏</h1>
                        <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏ –∏ –¥–∞–Ω–Ω—ã–º–∏ –ø–∞–ª–æ–º–Ω–∏–∫–æ–≤</p>
                    </div>
                    <div class="action-bar">
                        <button class="btn btn-primary" onclick="openModal('groupModal')">
                            <span>‚ûï</span>
                            –ù–æ–≤–∞—è –≥—Ä—É–ø–ø–∞
                        </button>
                        <button class="btn btn-secondary" onclick="openModal('pilgrimModal')">
                            <span>üë§</span>
                            –î–æ–±–∞–≤–∏—Ç—å –ø–∞–ª–æ–º–Ω–∏–∫–∞
                        </button>
                    </div>
                </div>

                <div class="three-column">
                    <!-- Column 1: Groups List -->
                    <div class="column">
                        <div class="column-header">
                            <span class="column-title">–ì—Ä—É–ø–ø—ã <span id="groupsCount">(0)</span></span>
                            <button class="btn btn-primary btn-sm" onclick="openModal('groupModal')">+</button>
                        </div>
                        <div class="column-body" id="groupsList"></div>
                    </div>

                    <!-- Column 2: Pilgrims List -->
                    <div class="column">
                        <div class="column-header">
                            <span class="column-title" id="pilgrimsTitle">–ü–∞–ª–æ–º–Ω–∏–∫–∏</span>
                            <button class="btn btn-primary btn-sm" onclick="openModal('pilgrimModal')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                        <div style="padding: 12px; border-bottom: 1px solid var(--border);">
                            <div class="search-input-wrapper">
                                <input type="text" class="form-input" placeholder="–ü–æ–∏—Å–∫ –ø–∞–ª–æ–º–Ω–∏–∫–æ–≤..." id="pilgrimSearch" oninput="filterPilgrims()">
                            </div>
                        </div>
                        <div class="column-body" id="pilgrimsList"></div>
                    </div>

                    <!-- Column 3: Pilgrim Card -->
                    <div class="column" id="pilgrimCard">
                        <div class="empty-state">
                            <div class="empty-state-icon">üë§</div>
                            <div class="empty-state-text">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ª–æ–º–Ω–∏–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Templates Page -->
            <div class="page" id="page-templates">
                <div class="content-header">
                    <div>
                        <h1 class="page-title">–®–∞–±–ª–æ–Ω—ã</h1>
                        <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤</p>
                    </div>
                    <div class="action-bar">
                        <button class="btn btn-primary" onclick="openModal('templateModal')">
                            <span>‚ûï</span>
                            –ù–æ–≤—ã–π —à–∞–±–ª–æ–Ω
                        </button>
                    </div>
                </div>

                <div class="tabs">
                    <button class="tab active" onclick="switchTab(this, 'message')">–®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π</button>
                    <button class="tab" onclick="switchTab(this, 'document')">–®–∞–±–ª–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</button>
                    <button class="tab" onclick="switchTab(this, 'process')">–®–∞–±–ª–æ–Ω—ã –ø—Ä–æ—Ü–µ—Å—Å–æ–≤</button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" id="templatesTitle">–®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                        <div class="action-bar">
                            <input type="text" class="form-input" placeholder="–ü–æ–∏—Å–∫ —à–∞–±–ª–æ–Ω–æ–≤..." style="width: 200px;">
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>–¢–∏–ø</th>
                                        <th>–¢—Ä–∏–≥–≥–µ—Ä</th>
                                        <th>–ö–∞–Ω–∞–ª</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="templatesTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Managers Page -->
            <div class="page" id="page-managers">
                <div class="content-header">
                    <div>
                        <h1 class="page-title">–ú–µ–Ω–µ–¥–∂–µ—Ä—ã</h1>
                        <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–º–∏ –∏ –≤–∏–∑–æ–≤—ã–º–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏</p>
                    </div>
                    <div class="action-bar">
                        <button class="btn btn-primary" onclick="openModal('managerModal')">
                            <span>‚ûï</span>
                            –î–æ–±–∞–≤–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">–°–ø–∏—Å–æ–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤</h3>
                        <div class="action-bar">
                            <input type="text" class="form-input" placeholder="–ü–æ–∏—Å–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤..." style="width: 200px;">
                            <select class="form-select" id="managerRoleFilter" onchange="filterManagers()" style="width: 150px;">
                                <option value="">–í—Å–µ —Ä–æ–ª–∏</option>
                                <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                                <option value="service">–°–µ—Ä–≤–∏—Å –º–µ–Ω–µ–¥–∂–µ—Ä</option>
                                <option value="visa">–í–∏–∑–∞ –º–µ–Ω–µ–¥–∂–µ—Ä</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>–ò–º—è</th>
                                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                        <th>Email</th>
                                        <th>–†–æ–ª—å</th>
                                        <th>–ì—Ä—É–ø–ø / –ó–∞—è–≤–æ–∫</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="managersTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Schedule Page -->
            <div class="page" id="page-schedule">
                <div class="content-header">
                    <div>
                        <h1 class="page-title">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h1>
                        <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –≤—ã–ª–µ—Ç–æ–≤ –∏ –ø—Ä–∏–ª–µ—Ç–æ–≤</p>
                    </div>
                    <div class="action-bar">
                        <button class="btn btn-primary" onclick="openModal('eventModal')">
                            <span>‚ûï</span>
                            –ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="calendar-nav">
                            <button class="btn btn-secondary btn-icon" onclick="changeMonth(-1)">‚óÄ</button>
                            <span class="calendar-month" id="calendarMonth"></span>
                            <button class="btn btn-secondary btn-icon" onclick="changeMonth(1)">‚ñ∂</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="calendar-grid" id="calendarGrid"></div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <h3 class="card-title">–ë–ª–∏–∂–∞–π—à–∏–µ –≤—ã–ª–µ—Ç—ã</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>–ì—Ä—É–ø–ø–∞</th>
                                        <th>–î–∞—Ç–∞ –≤—ã–ª–µ—Ç–∞</th>
                                        <th>–î–∞—Ç–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞</th>
                                        <th>–ü–∞–ª–æ–º–Ω–∏–∫–æ–≤</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="upcomingDeparturesTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div class="page" id="page-settings">
                <div class="content-header">
                    <div>
                        <h1 class="page-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h1>
                        <p class="page-subtitle">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</p>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ OCR</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">API –∫–ª—é—á OCR</label>
                                    <input type="password" class="form-input" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" id="ocrApiKey">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Endpoint</label>
                                    <input type="text" class="form-input" value="https://ocr.atlas-travel.com/api" id="ocrEndpoint">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">–Ø–∑—ã–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è</label>
                                    <select class="form-select" id="ocrLanguage">
                                        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                                        <option value="en">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
                                        <option value="ar">–ê—Ä–∞–±—Å–∫–∏–π</option>
                                    </select>
                                </div>
                            </div>
                            <button class="btn btn-secondary mt-2" onclick="testOCRConnection()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—á—Ç—ã (SMTP)</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">SMTP —Å–µ—Ä–≤–µ—Ä</label>
                                    <input type="text" class="form-input" value="smtp.example.com" id="smtpHost">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">–ü–æ—Ä—Ç</label>
                                    <input type="text" class="form-input" value="587" id="smtpPort">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">–õ–æ–≥–∏–Ω</label>
                                    <input type="text" class="form-input" value="noreply@atlas-travel.com" id="smtpLogin">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                                    <input type="password" class="form-input" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" id="smtpPassword">
                                </div>
                            </div>
                            <button class="btn btn-secondary mt-2" onclick="sendTestEmail()">–¢–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">WhatsApp API –∫–ª—é—á</label>
                                    <input type="password" class="form-input" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" id="whatsappApiKey">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">WhatsApp Endpoint</label>
                                    <input type="text" class="form-input" value="https://whatsapp-api.atlas-travel.com" id="whatsappEndpoint">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Telegram Bot Token</label>
                                    <input type="password" class="form-input" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" id="telegramToken">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è</label>
                                    <input type="number" class="form-input" value="8" id="minPasswordLength">
                                </div>
                                <div class="setting-row">
                                    <div class="setting-info">
                                        <div class="setting-name">–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</div>
                                        <div class="setting-desc">–¢—Ä–µ–±–æ–≤–∞—Ç—å 2FA –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                                    </div>
                                    <label class="toggle">
                                        <input type="checkbox" id="require2FA">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="setting-row">
                                    <div class="setting-info">
                                        <div class="setting-name">–ñ—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π</div>
                                        <div class="setting-desc">–ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                                    </div>
                                    <label class="toggle">
                                        <input type="checkbox" id="enableAuditLog" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary w-100 mt-3" onclick="saveSettings()">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Pilgrim Modal -->
    <div class="modal-overlay" id="pilgrimModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –ø–∞–ª–æ–º–Ω–∏–∫–∞</h3>
                <button class="modal-close" onclick="closeModal('pilgrimModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" class="form-input" id="pilgrimLastName">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ò–º—è</label>
                        <input type="text" class="form-input" id="pilgrimFirstName">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–û—Ç—á–µ—Å—Ç–≤–æ</label>
                        <input type="text" class="form-input" id="pilgrimMiddleName">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" class="form-input" id="pilgrimPhone">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</label>
                        <select class="form-select" id="pilgrimMessenger">
                            <option value="whatsapp">WhatsApp</option>
                            <option value="telegram">Telegram</option>
                            <option value="sms">SMS</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ì—Ä—É–ø–ø–∞</label>
                        <select class="form-select" id="pilgrimGroup"></select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('pilgrimModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="savePilgrim()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Group Modal -->
    <div class="modal-overlay" id="groupModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</h3>
                <button class="modal-close" onclick="closeModal('groupModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã</label>
                        <input type="text" class="form-input" id="groupName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£–º—Ä–∞ –ú–∞—Ä—Ç 2024">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ú–∞—Ä—à—Ä—É—Ç</label>
                        <input type="text" class="form-input" id="groupRoute" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ—Å–∫–≤–∞ - –ú–µ–¥–∏–Ω–∞ - –ú–µ–∫–∫–∞">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–î–∞—Ç–∞ –≤—ã–ª–µ—Ç–∞</label>
                        <input type="date" class="form-input" id="groupDeparture">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–î–∞—Ç–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞</label>
                        <input type="date" class="form-input" id="groupReturn">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–°–µ—Ä–≤–∏—Å –º–µ–Ω–µ–¥–∂–µ—Ä</label>
                        <select class="form-select" id="groupManager"></select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('groupModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveGroup()">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Manager Modal -->
    <div class="modal-overlay" id="managerModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="managerModalTitle">–î–æ–±–∞–≤–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞</h3>
                <button class="modal-close" onclick="closeModal('managerModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">–ò–º—è</label>
                        <input type="text" class="form-input" id="managerName">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" class="form-input" id="managerLastName">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" class="form-input" id="managerPhone">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="managerEmail">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–†–æ–ª—å</label>
                        <select class="form-select" id="managerRole">
                            <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                            <option value="service">–°–µ—Ä–≤–∏—Å –º–µ–Ω–µ–¥–∂–µ—Ä</option>
                            <option value="visa">–í–∏–∑–∞ –º–µ–Ω–µ–¥–∂–µ—Ä</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</label>
                        <select class="form-select" id="managerLanguage">
                            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('managerModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveManager()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Template Modal -->
    <div class="modal-overlay" id="templateModal">
        <div class="modal" style="max-width: 640px;">
            <div class="modal-header">
                <h3 class="modal-title">–°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω</h3>
                <button class="modal-close" onclick="closeModal('templateModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞</label>
                        <input type="text" class="form-input" id="templateName">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–¢–∏–ø</label>
                        <select class="form-select" id="templateType" onchange="updateTemplateFields()">
                            <option value="message">–°–æ–æ–±—â–µ–Ω–∏–µ</option>
                            <option value="document">–î–æ–∫—É–º–µ–Ω—Ç</option>
                            <option value="process">–ü—Ä–æ—Ü–µ—Å—Å</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–¢—Ä–∏–≥–≥–µ—Ä</label>
                        <select class="form-select" id="templateTrigger">
                            <option value="status_change">–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞</option>
                            <option value="document_uploaded">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞</option>
                            <option value="time_based">–ü–æ –≤—Ä–µ–º–µ–Ω–∏</option>
                            <option value="manual">–í—Ä—É—á–Ω—É—é</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ö–ª—é—á —Å–æ–±—ã—Ç–∏—è</label>
                        <input type="text" class="form-input" id="templateTriggerKey" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: visa_approved">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ö–∞–Ω–∞–ª</label>
                        <select class="form-select" id="templateChannel">
                            <option value="whatsapp">WhatsApp</option>
                            <option value="telegram">Telegram</option>
                            <option value="sms">SMS</option>
                            <option value="email">Email</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">–¢–µ–∫—Å—Ç —à–∞–±–ª–æ–Ω–∞</label>
                        <textarea class="form-textarea" id="templateContent" rows="6" placeholder="–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ {name}, {depart_date} –∏ –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ..."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="previewTemplate()">üëÅ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
                <button class="btn btn-secondary" onclick="closeModal('templateModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveTemplate()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Event Modal -->
    <div class="modal-overlay" id="eventModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">–°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ</h3>
                <button class="modal-close" onclick="closeModal('eventModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</label>
                        <input type="text" class="form-input" id="eventName">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–¢–∏–ø</label>
                        <select class="form-select" id="eventType">
                            <option value="departure">–í—ã–ª–µ—Ç</option>
                            <option value="arrival">–ü—Ä–∏–ª—ë—Ç</option>
                            <option value="other">–î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–î–∞—Ç–∞</label>
                        <input type="date" class="form-input" id="eventDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–í—Ä–µ–º—è</label>
                        <input type="time" class="form-input" id="eventTime">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–°–≤—è–∑–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã</label>
                        <select class="form-select" id="eventGroup" multiple style="height: 100px;"></select>
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                        <textarea class="form-textarea" id="eventNote"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('eventModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveEvent()">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ==================== DATA MODEL ====================
        let currentRole = 'admin'; // admin, service, visa
        let users = [
            { id: 1, name: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä", lastName: "–ö–æ–∑–ª–æ–≤", phone: "+7 999 555-66-77", email: "admin@atlas.com", role: "admin", language: "ru", created_at: "2024-01-15" },
            { id: 2, name: "–ú–∞—Ä–∏—è", lastName: "–ü–µ—Ç—Ä–æ–≤–∞", phone: "+7 999 111-22-33", email: "petrov@atlas.com", role: "service", language: "ru", created_at: "2024-02-20", groups_count: 8 },
            { id: 3, name: "–ò–≤–∞–Ω", lastName: "–°–∏–¥–æ—Ä–æ–≤", phone: "+7 999 222-33-44", email: "sidorov@atlas.com", role: "service", language: "ru", created_at: "2024-03-10", groups_count: 6 },
            { id: 4, name: "–ï–ª–µ–Ω–∞", lastName: "–ö–æ–∑–ª–æ–≤–∞", phone: "+7 999 333-44-55", email: "kozlova@atlas.com", role: "visa", language: "ru", created_at: "2024-03-15", visas_count: 145 },
            { id: 5, name: "–î–º–∏—Ç—Ä–∏–π", lastName: "–í–æ–ª–∫–æ–≤", phone: "+7 999 444-55-66", email: "volkov@atlas.com", role: "visa", language: "ru", created_at: "2024-04-05", visas_count: 98 }
        ];

        let service_groups = [
            { id: 1, name: "–£–º—Ä–∞ –î–µ–∫–∞–±—Ä—å 2024", route: "–ú–æ—Å–∫–≤–∞ - –ú–µ–¥–∏–Ω–∞ - –ú–µ–∫–∫–∞", depart_date: "2024-12-15", return_date: "2024-12-25", status: "active", manager_id: 2, created_at: "2024-09-10", pilgrims: [1, 2, 3] },
            { id: 2, name: "–•–∞–¥–∂ 2025 - –ì—Ä—É–ø–ø–∞ –ê", route: "–°—Ç–∞–º–±—É–ª - –î–∂–∏–¥–¥–∞ - –ú–µ–∫–∫–∞", depart_date: "2025-06-01", return_date: "2025-06-20", status: "preparing", manager_id: 3, created_at: "2024-10-15", pilgrims: [4, 5] },
            { id: 3, name: "–£–º—Ä–∞ –Ø–Ω–≤–∞—Ä—å 2025", route: "–î—É–±–∞–π - –ú–µ–¥–∏–Ω–∞ - –ú–µ–∫–∫–∞", depart_date: "2025-01-10", return_date: "2025-01-20", status: "active", manager_id: 2, created_at: "2024-11-05", pilgrims: [6] },
            { id: 4, name: "–•–∞–¥–∂ 2025 - –ì—Ä—É–ø–ø–∞ –ë", route: "–ê—Å—Ç–∞–Ω–∞ - –î–∂–∏–¥–¥–∞ - –ú–µ–∫–∫–∞", depart_date: "2025-06-05", return_date: "2025-06-25", status: "preparing", manager_id: 2, created_at: "2024-11-20", pilgrims: [] },
            { id: 5, name: "–£–º—Ä–∞ –§–µ–≤—Ä–∞–ª—å 2025", route: "–ú–æ—Å–∫–≤–∞ - –ú–µ–¥–∏–Ω–∞ - –ú–µ–∫–∫–∞", depart_date: "2025-02-14", return_date: "2025-02-24", status: "active", manager_id: 3, created_at: "2024-12-01", pilgrims: [] }
        ];

        let pilgrims = [
            { 
                id: 1, 
                group_id: 1, 
                full_name: "–ê–ª–∏–µ–≤ –ê—Ö–º–µ–¥ –†—É—Å—Ç–∞–º–æ–≤–∏—á", 
                phone: "+7 999 123-45-67", 
                messenger: "whatsapp",
                status: "active",
                depart_date: "2024-12-15",
                return_date: "2024-12-25",
                passport: {
                    number: "75 1234567",
                    citizenship: "–†–§",
                    birth_date: "1985-03-20",
                    gender: "–ú—É–∂",
                    issue_date: "2018-05-15",
                    expiry_date: "2028-05-15",
                    authority: "–£–§–ú–° –†–æ—Å—Å–∏–∏",
                    photo_url: null,
                    ocr_status: "checked",
                    verified: true
                },
                visa: {
                    status: "approved",
                    hasInsurance: true
                },
                documents: [
                    { id: 1, type: "passport", uploaded_at: "2024-11-20", uploaded_by: "–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞" },
                    { id: 2, type: "visa", uploaded_at: "2024-12-01", uploaded_by: "–ï–ª–µ–Ω–∞ –ö–æ–∑–ª–æ–≤–∞" },
                    { id: 3, type: "insurance", uploaded_at: "2024-11-25", uploaded_by: "–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞" }
                ]
            },
            { 
                id: 2, 
                group_id: 1, 
                full_name: "–ò—Å–º–∞–∏–ª–æ–≤–∞ –§–∞—Ç–∏–º–∞ –ú–∞—Ä–∞—Ç–æ–≤–Ω–∞", 
                phone: "+7 999 234-56-78", 
                messenger: "telegram",
                status: "active",
                depart_date: "2024-12-15",
                return_date: "2024-12-25",
                passport: {
                    number: "75 2345678",
                    citizenship: "–†–§",
                    birth_date: "1990-07-15",
                    gender: "–ñ–µ–Ω",
                    issue_date: "2017-08-22",
                    expiry_date: "2027-08-22",
                    authority: "–£–§–ú–° –†–æ—Å—Å–∏–∏",
                    photo_url: null,
                    ocr_status: "ocr_done",
                    verified: false
                },
                visa: {
                    status: "pending",
                    hasInsurance: true
                },
                documents: [
                    { id: 4, type: "passport", uploaded_at: "2024-11-22", uploaded_by: "–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞" }
                ]
            },
            { 
                id: 3, 
                group_id: 1, 
                full_name: "–•–∞—Å–∞–Ω–æ–≤ –ú—É—Å—Ç–∞—Ñ–∞ –†–∞—à–∏–¥–æ–≤–∏—á", 
                phone: "+7 999 345-67-89", 
                messenger: "whatsapp",
                status: "active",
                depart_date: "2024-12-15",
                return_date: "2024-12-25",
                passport: {
                    number: "75 3456789",
                    citizenship: "–†–§",
                    birth_date: "1978-12-05",
                    gender: "–ú—É–∂",
                    issue_date: "2016-11-30",
                    expiry_date: "2026-11-30",
                    authority: "–£–§–ú–° –†–æ—Å—Å–∏–∏",
                    photo_url: null,
                    ocr_status: "new",
                    verified: false
                },
                visa: {
                    status: "none",
                    hasInsurance: false
                },
                documents: [
                    { id: 5, type: "passport", uploaded_at: "2024-11-25", uploaded_by: "–ò–≤–∞–Ω –°–∏–¥–æ—Ä–æ–≤" }
                ]
            },
            { 
                id: 4, 
                group_id: 2, 
                full_name: "–ì–∞–¥–∂–∏–µ–≤–∞ –ê–º–∏–Ω–∞ –ú–∞–≥–æ–º–µ–¥–æ–≤–Ω–∞", 
                phone: "+7 999 456-78-90", 
                messenger: "whatsapp",
                status: "active",
                depart_date: "2025-06-01",
                return_date: "2025-06-20",
                passport: {
                    number: "75 4567890",
                    citizenship: "–†–§",
                    birth_date: "1995-04-10",
                    gender: "–ñ–µ–Ω",
                    issue_date: "2019-02-18",
                    expiry_date: "2029-02-18",
                    authority: "–ú–í–î –†–æ—Å—Å–∏–∏",
                    photo_url: null,
                    ocr_status: "checked",
                    verified: true
                },
                visa: {
                    status: "approved",
                    hasInsurance: true
                },
                documents: [
                    { id: 6, type: "passport", uploaded_at: "2024-11-18", uploaded_by: "–ò–≤–∞–Ω –°–∏–¥–æ—Ä–æ–≤" },
                    { id: 7, type: "visa", uploaded_at: "2024-12-03", uploaded_by: "–ï–ª–µ–Ω–∞ –ö–æ–∑–ª–æ–≤–∞" }
                ]
            },
            { 
                id: 5, 
                group_id: 2, 
                full_name: "–ú–∞–≥–æ–º–µ–¥–æ–≤ –†—É—Å—Ç–∞–º –ê—Ö–º–µ–¥–æ–≤–∏—á", 
                phone: "+7 999 567-89-01", 
                messenger: "telegram",
                status: "active",
                depart_date: "2025-06-01",
                return_date: "2025-06-20",
                passport: {
                    number: "75 5678901",
                    citizenship: "–†–§",
                    birth_date: "1982-09-28",
                    gender: "–ú—É–∂",
                    issue_date: "2017-06-25",
                    expiry_date: "2027-06-25",
                    authority: "–ú–í–î –†–æ—Å—Å–∏–∏",
                    photo_url: null,
                    ocr_status: "checked",
                    verified: true
                },
                visa: {
                    status: "pending",
                    hasInsurance: false
                },
                documents: [
                    { id: 8, type: "passport", uploaded_at: "2024-11-20", uploaded_by: "–ò–≤–∞–Ω –°–∏–¥–æ—Ä–æ–≤" }
                ]
            },
            { 
                id: 6, 
                group_id: 3, 
                full_name: "–ê–±–¥—É–ª–ª–∞–µ–≤–∞ –ó–∞—Ä–µ–º–∞ –ò—Å–ª–∞–º–æ–≤–Ω–∞", 
                phone: "+7 999 678-90-12", 
                messenger: "whatsapp",
                status: "active",
                depart_date: "2025-01-10",
                return_date: "2025-01-20",
                passport: {
                    number: "75 6789012",
                    citizenship: "–†–§",
                    birth_date: "1988-01-17",
                    gender: "–ñ–µ–Ω",
                    issue_date: "2018-09-12",
                    expiry_date: "2028-09-12",
                    authority: "–ú–í–î –†–æ—Å—Å–∏–∏",
                    photo_url: null,
                    ocr_status: "checked",
                    verified: true
                },
                visa: {
                    status: "approved",
                    hasInsurance: true
                },
                documents: [
                    { id: 9, type: "passport", uploaded_at: "2024-11-22", uploaded_by: "–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞" },
                    { id: 10, type: "visa", uploaded_at: "2024-12-05", uploaded_by: "–ï–ª–µ–Ω–∞ –ö–æ–∑–ª–æ–≤–∞" },
                    { id: 11, type: "insurance", uploaded_at: "2024-11-28", uploaded_by: "–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞" }
                ]
            }
        ];

        let templates = [
            { id: 1, name: "–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –£–º—Ä—É", type: "message", trigger_type: "manual", trigger_key: "invitation", channel: "whatsapp", body: "–£–≤–∞–∂–∞–µ–º—ã–π {name}, –ø—Ä–∏–≥–ª–∞—à–∞–µ–º –≤–∞—Å –≤ –ø–æ–µ–∑–¥–∫—É {route} {depart_date}.", is_active: true, created_at: "2024-12-01" },
            { id: 2, name: "SMS: –í–∏–∑–∞ –æ–¥–æ–±—Ä–µ–Ω–∞", type: "message", trigger_type: "status_change", trigger_key: "visa_approved", channel: "sms", body: "{name}, –≤–∞—à–∞ –≤–∏–∑–∞ –æ–¥–æ–±—Ä–µ–Ω–∞! –§–∞–π–ª –≤–æ –≤–ª–æ–∂–µ–Ω–∏–∏.", is_active: true, created_at: "2024-11-28" },
            { id: 3, name: "–ß–µ–∫-–ª–∏—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤", type: "document", trigger_type: "manual", trigger_key: "checklist", channel: "email", body: "–°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è {trip_type}...", is_active: true, created_at: "2024-11-25" },
            { id: 4, name: "–ü—Ä–æ—Ü–µ—Å—Å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –≤–∏–∑—ã", type: "process", trigger_type: "time_based", trigger_key: "visa_process", channel: "email", body: "–®–∞–≥ 1: –°–±–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤...", is_active: true, created_at: "2024-11-20" },
            { id: 5, name: "Email: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ", type: "message", trigger_type: "time_based", trigger_key: "reminder", channel: "email", body: "–ù–∞–ø–æ–º–∏–Ω–∞–µ–º –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã.", is_active: false, created_at: "2024-11-15" }
        ];

        let calendar_events = [
            { id: 1, name: "–í—ã–ª–µ—Ç –£–º—Ä–∞ –î–µ–∫–∞–±—Ä—å", type: "departure", date: "2024-12-15", time: "08:30", group_ids: [1], note: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –®–µ—Ä–µ–º–µ—Ç—å–µ–≤–æ, —Ç–µ—Ä–º–∏–Ω–∞–ª D" },
            { id: 2, name: "–ü—Ä–∏–ª—ë—Ç –£–º—Ä–∞ –î–µ–∫–∞–±—Ä—å", type: "arrival", date: "2024-12-25", time: "22:15", group_ids: [1], note: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –®–µ—Ä–µ–º–µ—Ç—å–µ–≤–æ" },
            { id: 3, name: "–í—ã–ª–µ—Ç –£–º—Ä–∞ –Ø–Ω–≤–∞—Ä—å", type: "departure", date: "2025-01-10", time: "10:45", group_ids: [3], note: "–ê—ç—Ä–æ–ø–æ—Ä—Ç –î–æ–º–æ–¥–µ–¥–æ–≤–æ" }
        ];

        let activities = [
            { id: 1, icon: "üë§", color: "var(--primary)", text: "–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –ø–∞–ª–æ–º–Ω–∏–∫: –ê—Ö–º–µ–¥ –ê–ª–∏–µ–≤", time: "5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥" },
            { id: 2, icon: "‚úì", color: "var(--success)", text: "–í–∏–∑–∞ –æ–¥–æ–±—Ä–µ–Ω–∞: –§–∞—Ç–∏–º–∞ –ò—Å–º–∞–∏–ª–æ–≤–∞", time: "15 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥" },
            { id: 3, icon: "üìÑ", color: "var(--secondary)", text: "–û–±–Ω–æ–≤–ª—ë–Ω —à–∞–±–ª–æ–Ω: –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –£–º—Ä—É", time: "1 —á–∞—Å –Ω–∞–∑–∞–¥" },
            { id: 4, icon: "üìÅ", color: "var(--warning)", text: "–°–æ–∑–¥–∞–Ω–∞ –≥—Ä—É–ø–ø–∞: –£–º—Ä–∞ –ú–∞—Ä—Ç 2025", time: "2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥" },
            { id: 5, icon: "üîî", color: "var(--primary)", text: "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–µ –•–∞–¥–∂ 2025", time: "3 —á–∞—Å–∞ –Ω–∞–∑–∞–¥" },
            { id: 6, icon: "üë§", color: "var(--primary)", text: "–ù–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä: –ï–ª–µ–Ω–∞ –ö–æ–∑–ª–æ–≤–∞", time: "–í—á–µ—Ä–∞" }
        ];

        let system_settings = {
            ocr: {
                api_key: "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",
                endpoint: "https://ocr.atlas-travel.com/api",
                language: "ru"
            },
            smtp: {
                host: "smtp.example.com",
                port: "587",
                login: "noreply@atlas-travel.com",
                password: "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",
                from: "noreply@atlas-travel.com"
            },
            messengers: {
                whatsapp_api_key: "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",
                whatsapp_endpoint: "https://whatsapp-api.atlas-travel.com",
                telegram_token: "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            },
            security: {
                min_password_length: 8,
                require_2fa: false,
                enable_audit_log: true
            }
        };

        // State Management
        let selectedGroup = null;
        let selectedPilgrim = null;
        let editingManagerId = null;
        let editingTemplateId = null;
        let currentMonth = new Date();
        let currentTemplateTab = 'message';

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboardStats();
            renderGroupsList();
            renderManagersTable();
            renderTemplatesTable();
            renderActivityList();
            renderChart();
            renderCalendar();
            populateGroupSelects();
            populateManagerSelects();
            updateRoleBadge();
            renderUpcomingDepartures();
        });

        // ==================== NAVIGATION ====================
        function showPage(pageId, navItem) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if (navItem) navItem.classList.add('active');
            
            const titles = {
                'dashboard': '–î–∞—à–±–æ—Ä–¥',
                'groups': '–ì—Ä—É–ø–ø—ã –∏ –ø–∞–ª–æ–º–Ω–∏–∫–∏',
                'templates': '–®–∞–±–ª–æ–Ω—ã',
                'managers': '–ú–µ–Ω–µ–¥–∂–µ—Ä—ã',
                'schedule': '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ',
                'settings': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã'
            };
            
            document.querySelector('.page-title').textContent = titles[pageId];
            
            // Load page-specific data
            loadPageData(pageId);
            
            // Close mobile sidebar
            document.getElementById('sidebar').classList.remove('open');
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        function toggleRole() {
            const roles = ['admin', 'service', 'visa'];
            const roleNames = {
                'admin': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                'service': '–°–µ—Ä–≤–∏—Å –º–µ–Ω–µ–¥–∂–µ—Ä',
                'visa': '–í–∏–∑–∞ –º–µ–Ω–µ–¥–∂–µ—Ä'
            };
            
            const currentIndex = roles.indexOf(currentRole);
            currentRole = roles[(currentIndex + 1) % roles.length];
            
            const roleBadge = document.getElementById('currentRole');
            roleBadge.textContent = roleNames[currentRole];
            roleBadge.className = `role-badge ${currentRole}`;
            
            showToast(`–†–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞: ${roleNames[currentRole]}`, 'info');
        }

        function updateRoleBadge() {
            const roleNames = {
                'admin': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                'service': '–°–µ—Ä–≤–∏—Å –º–µ–Ω–µ–¥–∂–µ—Ä',
                'visa': '–í–∏–∑–∞ –º–µ–Ω–µ–¥–∂–µ—Ä'
            };
            
            const roleBadge = document.getElementById('currentRole');
            roleBadge.textContent = roleNames[currentRole];
            roleBadge.className = `role-badge ${currentRole}`;
        }

        function loadPageData(page) {
            switch(page) {
                case 'dashboard':
                    updateDashboardStats();
                    break;
                case 'templates':
                    renderTemplatesTable();
                    break;
                case 'managers':
                    renderManagersTable();
                    break;
                case 'schedule':
                    renderCalendar();
                    renderUpcomingDepartures();
                    break;
            }
        }

        // ==================== MODALS ====================
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            if (modalId === 'managerModal') {
                editingManagerId = null;
                document.getElementById('managerModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞';
            }
            if (modalId === 'templateModal') {
                editingTemplateId = null;
            }
        }

        // ==================== TOAST NOTIFICATIONS ====================
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const icons = {
                success: '‚úì',
                error: '‚úï',
                warning: '‚ö†',
                info: '‚Ñπ'
            };
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <span class="toast-icon">${icons[type]}</span>
                <span class="toast-message">${message}</span>
                <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // ==================== DASHBOARD ====================
        function updateDashboardStats() {
            const totalPilgrims = pilgrims.length;
            const readyPilgrims = pilgrims.filter(p => p.visa.status === 'approved' && p.passport.ocr_status === 'checked').length;
            const pendingVisas = pilgrims.filter(p => p.visa.status === 'pending').length;
            const upcomingGroups = service_groups.filter(g => new Date(g.depart_date) > new Date()).length;
            
            document.getElementById('statTotalPilgrims').textContent = totalPilgrims;
            document.getElementById('statReady').textContent = readyPilgrims;
            document.getElementById('statPending').textContent = pendingVisas;
            document.getElementById('statUpcoming').textContent = upcomingGroups;
            
            // Update visa stats
            const visaApproved = pilgrims.filter(p => p.visa.status === 'approved').length;
            const visaPending = pilgrims.filter(p => p.visa.status === 'pending').length;
            const visaNone = pilgrims.filter(p => p.visa.status === 'none').length;
            
            document.getElementById('visaApprovedCount').textContent = visaApproved;
            document.getElementById('visaPendingCount').textContent = visaPending;
            document.getElementById('visaNoneCount').textContent = visaNone;
        }

        function renderChart() {
            const container = document.getElementById('monthlyChart');
            const months = ['–ò—é–ª', '–ê–≤–≥', '–°–µ–Ω', '–û–∫—Ç', '–ù–æ—è', '–î–µ–∫'];
            const values = [85, 120, 95, 140, 175, 210];
            const maxValue = Math.max(...values);
            
            container.innerHTML = months.map((month, i) => `
                <div class="chart-bar" style="height: ${(values[i] / maxValue) * 100}%;">
                    <span class="chart-bar-value">${values[i]}</span>
                    <span class="chart-bar-label">${month}</span>
                </div>
            `).join('');
        }

        function renderActivityList() {
            const container = document.getElementById('activityList');
            container.innerHTML = activities.map(a => `
                <div class="activity-item">
                    <div class="activity-icon" style="background: ${a.color}20; color: ${a.color};">
                        ${a.icon}
                    </div>
                    <div class="activity-content">
                        <div class="activity-text">${a.text}</div>
                        <div class="activity-time">${a.time}</div>
                    </div>
                </div>
            `).join('');
        }

        function showAllActivities() {
            showToast('–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏...', 'info');
        }

        function quickReport() {
            showToast('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç—á–µ—Ç–∞...', 'info');
            setTimeout(() => {
                showToast('–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!', 'success');
            }, 1500);
        }

        // ==================== GROUPS & PILGRIMS ====================
        function renderGroupsList() {
            const container = document.getElementById('groupsList');
            const groupsCount = service_groups.length;
            document.getElementById('groupsCount').textContent = `(${groupsCount})`;
            
            container.innerHTML = service_groups.map(g => {
                const manager = users.find(u => u.id === g.manager_id);
                const pilgrimsCount = g.pilgrims ? g.pilgrims.length : 0;
                const departDate = formatDate(g.depart_date);
                
                return `
                    <div class="list-item ${selectedGroup === g.id ? 'active' : ''}" onclick="selectGroup(${g.id})">
                        <div class="list-item-title">${g.name}</div>
                        <div class="list-item-sub">${g.route}</div>
                        <div class="list-item-sub">–í—ã–ª–µ—Ç: ${departDate} ‚Ä¢ ${pilgrimsCount} –ø–∞–ª–æ–º–Ω–∏–∫–æ–≤</div>
                        <div class="list-item-sub">–ú–µ–Ω–µ–¥–∂–µ—Ä: ${manager ? manager.name + ' ' + manager.lastName : '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω'}</div>
                    </div>
                `;
            }).join('');
        }

        function selectGroup(groupId) {
            selectedGroup = groupId;
            selectedPilgrim = null;
            renderGroupsList();
            renderPilgrimsList();
            renderPilgrimCard();
            
            const group = service_groups.find(g => g.id === groupId);
            const pilgrimsCount = group && group.pilgrims ? group.pilgrims.length : 0;
            document.getElementById('pilgrimsTitle').textContent = `–ü–∞–ª–æ–º–Ω–∏–∫–∏ (${pilgrimsCount})`;
        }

        function renderPilgrimsList() {
            const container = document.getElementById('pilgrimsList');
            
            if (!selectedGroup) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìÅ</div><div class="empty-state-text">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</div></div>';
                return;
            }
            
            const groupPilgrims = pilgrims.filter(p => p.group_id === selectedGroup);
            const searchTerm = document.getElementById('pilgrimSearch').value.toLowerCase();
            const filtered = groupPilgrims.filter(p => 
                p.full_name.toLowerCase().includes(searchTerm) || 
                p.phone.toLowerCase().includes(searchTerm)
            );
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë§</div><div class="empty-state-text">–ü–∞–ª–æ–º–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div></div>';
                return;
            }
            
            container.innerHTML = filtered.map(p => {
                return `
                    <div class="pilgrim-item ${selectedPilgrim === p.id ? 'active' : ''}" onclick="selectPilgrim(${p.id})">
                        <div class="pilgrim-avatar">${getInitials(p.full_name)}</div>
                        <div class="pilgrim-info">
                            <div class="pilgrim-name">${p.full_name}</div>
                            <div class="pilgrim-passport">${p.phone} ‚Ä¢ ${getMessengerBadge(p.messenger)}</div>
                        </div>
                        ${getVisaStatusBadge(p.visa.status)}
                    </div>
                `;
            }).join('');
        }

        function filterPilgrims() {
            renderPilgrimsList();
        }

        function selectPilgrim(pilgrimId) {
            selectedPilgrim = pilgrimId;
            renderPilgrimsList();
            renderPilgrimCard();
        }

        function getInitials(fullName) {
            return fullName.split(' ').map(n => n[0]).join('').toUpperCase();
        }

        function getMessengerBadge(messenger) {
            const badges = {
                'whatsapp': '<span class="badge badge-success">WhatsApp</span>',
                'telegram': '<span class="badge badge-primary">Telegram</span>',
                'sms': '<span class="badge badge-secondary">SMS</span>'
            };
            return badges[messenger] || '';
        }

        function getVisaStatusBadge(status) {
            const badges = {
                'none': '<span class="badge badge-neutral">–ë–µ–∑ –≤–∏–∑—ã</span>',
                'pending': '<span class="badge badge-warning">–û–∂–∏–¥–∞–Ω–∏–µ</span>',
                'approved': '<span class="badge badge-success">–û–¥–æ–±—Ä–µ–Ω–æ</span>'
            };
            return badges[status] || badges['none'];
        }

        function getOCRStatusBadge(status) {
            const badges = {
                'new': '<span class="ocr-status new">OCR –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è</span>',
                'ocr_done': '<span class="ocr-status ocr_done">OCR –≤—ã–ø–æ–ª–Ω–µ–Ω</span>',
                'checked': '<span class="ocr-status checked">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</span>'
            };
            return badges[status] || badges['new'];
        }

        function renderPilgrimCard() {
            const container = document.getElementById('pilgrimCard');
            
            if (!selectedPilgrim) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë§</div><div class="empty-state-text">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ª–æ–º–Ω–∏–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</div></div>';
                return;
            }
            
            const p = pilgrims.find(p => p.id === selectedPilgrim);
            const group = service_groups.find(g => g.id === p.group_id);
            
            container.innerHTML = `
                <div class="pilgrim-card-header">
                    <div class="pilgrim-card-avatar">${getInitials(p.full_name)}</div>
                    <div>
                        <div class="pilgrim-card-name">${p.full_name}</div>
                        <div class="pilgrim-card-id">ID: ${p.id} ‚Ä¢ ${group ? group.name : '–ì—Ä—É–ø–ø–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'}</div>
                    </div>
                </div>
                <div class="pilgrim-card-body">
                    <div>
                        <div class="info-section">
                            <div class="info-section-title">
                                –ü–∞—Å–ø–æ—Ä—Ç –∏ OCR
                                ${getOCRStatusBadge(p.passport.ocr_status)}
                            </div>
                            <div class="help-text">OCR —Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–∞—Å–ø–æ—Ä—Ç–∞, —Å–µ—Ä–≤–∏—Å-–º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç.</div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">–°–µ—Ä–∏—è/–Ω–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞</label>
                                    <input type="text" class="form-input" id="passportNumber" value="${p.passport.number || ''}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">–ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ</label>
                                    <input type="text" class="form-input" id="passportCitizenship" value="${p.passport.citizenship || ''}">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                                    <input type="date" class="form-input" id="passportBirthDate" value="${p.passport.birth_date || ''}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">–ü–æ–ª</label>
                                    <select class="form-select" id="passportGender">
                                        <option value="–ú—É–∂" ${p.passport.gender === '–ú—É–∂' ? 'selected' : ''}>–ú—É–∂</option>
                                        <option value="–ñ–µ–Ω" ${p.passport.gender === '–ñ–µ–Ω' ? 'selected' : ''}>–ñ–µ–Ω</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</label>
                                    <input type="date" class="form-input" id="passportIssueDate" value="${p.passport.issue_date || ''}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ</label>
                                    <input type="date" class="form-input" id="passportExpiryDate" value="${p.passport.expiry_date || ''}">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">–ö–µ–º –≤—ã–¥–∞–Ω</label>
                                <input type="text" class="form-input" id="passportAuthority" value="${p.passport.authority || ''}">
                            </div>
                            
                            <div class="file-input-wrapper">
                                <input type="file" id="passportFile" accept="image/*,.pdf">
                                <div class="file-input-label">
                                    <span>üìÑ</span>
                                    <span>–ü–∞—Å–ø–æ—Ä—Ç (–æ—Ä–∏–≥–∏–Ω–∞–ª): –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</span>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 8px; margin-top: 16px;">
                                <button class="btn btn-secondary btn-sm" onclick="runOCR(${p.id})">üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å OCR</button>
                                <button class="btn btn-success btn-sm" onclick="markPassportChecked(${p.id})">‚úì –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ</button>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="info-section">
                            <div class="info-section-title">
                                –í–∏–∑–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã
                                ${getVisaStatusBadge(p.visa.status)}
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">–°—Ç–∞—Ç—É—Å –≤–∏–∑—ã</label>
                                    <select class="form-select" id="visaStatus">
                                        <option value="none" ${p.visa.status === 'none' ? 'selected' : ''}>–ù–µ—Ç –∑–∞—è–≤–∫–∏</option>
                                        <option value="pending" ${p.visa.status === 'pending' ? 'selected' : ''}>–û–∂–∏–¥–∞–Ω–∏–µ</option>
                                        <option value="approved" ${p.visa.status === 'approved' ? 'selected' : ''}>–û–¥–æ–±—Ä–µ–Ω–æ</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">–ú–µ–¥—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞</label>
                                    <select class="form-select" id="insuranceStatus">
                                        <option value="yes" ${p.visa.hasInsurance ? 'selected' : ''}>–ï—Å—Ç—å</option>
                                        <option value="no" ${!p.visa.hasInsurance ? 'selected' : ''}>–ù–µ—Ç</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="file-input-wrapper">
                                <input type="file" id="visaFile" accept=".pdf,.jpg,.jpeg,.png">
                                <div class="file-input-label">
                                    <span>üìÑ</span>
                                    <span>–ì–æ—Ç–æ–≤–∞—è –≤–∏–∑–∞: –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</span>
                                </div>
                            </div>
                            
                            <div class="file-input-wrapper">
                                <input type="file" id="insuranceFile" accept=".pdf,.jpg,.jpeg,.png">
                                <div class="file-input-label">
                                    <span>üìÑ</span>
                                    <span>–ú–µ–¥—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞: –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</span>
                                </div>
                            </div>
                            
                            <div class="info-section-title" style="margin-top: 20px;">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</div>
                            ${p.documents && p.documents.length > 0 ? p.documents.map(doc => {
                                return `
                                    <div class="document-item">
                                        <div class="document-icon">üìÑ</div>
                                        <div class="document-info">
                                            <div class="document-name">${getDocumentTypeName(doc.type)}</div>
                                            <div class="document-meta">–ó–∞–≥—Ä—É–∂–µ–Ω ${formatDate(doc.uploaded_at)} ‚Ä¢ ${doc.uploaded_by}</div>
                                        </div>
                                        <div style="display: flex; gap: 4px;">
                                            <button class="btn btn-secondary btn-icon btn-sm" onclick="openDocument(${doc.id})">üëÅ</button>
                                            <button class="btn btn-secondary btn-icon btn-sm" onclick="downloadDocument(${doc.id})">‚Üì</button>
                                        </div>
                                    </div>
                                `;
                            }).join('') : '<div class="empty-state-text">–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</div>'}
                        </div>
                    </div>
                </div>
                <div class="pilgrim-card-actions">
                    <button class="btn btn-primary btn-block" onclick="savePilgrimChanges(${p.id})">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>
            `;
        }

        function getDocumentTypeName(type) {
            const names = {
                'passport': '–ü–∞—Å–ø–æ—Ä—Ç',
                'visa': '–í–∏–∑–∞',
                'insurance': '–ú–µ–¥—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞',
                'ticket': '–ë–∏–ª–µ—Ç',
                'hotel_voucher': '–í–∞—É—á–µ—Ä –æ—Ç–µ–ª—è',
                'itinerary': '–ú–∞—Ä—à—Ä—É—Ç',
                'memo': '–°–ª—É–∂–µ–±–Ω–∞—è –∑–∞–ø–∏—Å–∫–∞'
            };
            return names[type] || type;
        }

        function runOCR(pilgrimId) {
            showToast('–ó–∞–ø—É—Å–∫ OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞...', 'info');
            setTimeout(() => {
                const pilgrim = pilgrims.find(p => p.id === pilgrimId);
                pilgrim.passport.ocr_status = 'ocr_done';
                renderPilgrimCard();
                showToast('OCR —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ.', 'success');
            }, 1500);
        }

        function markPassportChecked(pilgrimId) {
            const pilgrim = pilgrims.find(p => p.id === pilgrimId);
            pilgrim.passport.ocr_status = 'checked';
            pilgrim.passport.verified = true;
            renderPilgrimCard();
            showToast('–ü–∞—Å–ø–æ—Ä—Ç –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π', 'success');
        }

        function openDocument(docId) {
            showToast(`–û—Ç–∫—Ä—ã—Ç–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ #${docId} (–≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–¥–µ—Å—å –±—ã–ª –±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä)`, 'info');
        }

        function downloadDocument(docId) {
            showToast(`–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ #${docId}`, 'info');
        }

        function savePilgrimChanges(pilgrimId) {
            const pilgrim = pilgrims.find(p => p.id === pilgrimId);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Å–ø–æ—Ä—Ç–∞
            pilgrim.passport.number = document.getElementById('passportNumber').value;
            pilgrim.passport.citizenship = document.getElementById('passportCitizenship').value;
            pilgrim.passport.birth_date = document.getElementById('passportBirthDate').value;
            pilgrim.passport.gender = document.getElementById('passportGender').value;
            pilgrim.passport.issue_date = document.getElementById('passportIssueDate').value;
            pilgrim.passport.expiry_date = document.getElementById('passportExpiryDate').value;
            pilgrim.passport.authority = document.getElementById('passportAuthority').value;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤–∏–∑—ã
            pilgrim.visa.status = document.getElementById('visaStatus').value;
            pilgrim.visa.hasInsurance = document.getElementById('insuranceStatus').value === 'yes';
            
            showToast('–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã (–≤ –ø–∞–º—è—Ç–∏)', 'success');
            updateDashboardStats();
        }

        function savePilgrim() {
            const newPilgrim = {
                id: pilgrims.length + 1,
                group_id: parseInt(document.getElementById('pilgrimGroup').value) || selectedGroup || 1,
                full_name: `${document.getElementById('pilgrimLastName').value || '–ù–æ–≤—ã–π'} ${document.getElementById('pilgrimFirstName').value || '–ü–∞–ª–æ–º–Ω–∏–∫'} ${document.getElementById('pilgrimMiddleName').value || ''}`,
                phone: document.getElementById('pilgrimPhone').value || '+7 999 000-00-00',
                messenger: document.getElementById('pilgrimMessenger').value || 'whatsapp',
                status: 'active',
                depart_date: service_groups.find(g => g.id === (parseInt(document.getElementById('pilgrimGroup').value) || selectedGroup || 1))?.depart_date || '2025-01-01',
                return_date: service_groups.find(g => g.id === (parseInt(document.getElementById('pilgrimGroup').value) || selectedGroup || 1))?.return_date || '2025-01-15',
                passport: {
                    ocr_status: 'new',
                    verified: false
                },
                visa: {
                    status: 'none',
                    hasInsurance: false
                },
                documents: []
            };
            
            pilgrims.push(newPilgrim);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞–ª–æ–º–Ω–∏–∫–∞ –≤ –≥—Ä—É–ø–ø—É
            const group = service_groups.find(g => g.id === newPilgrim.group_id);
            if (group && !group.pilgrims) group.pilgrims = [];
            if (group && !group.pilgrims.includes(newPilgrim.id)) {
                group.pilgrims.push(newPilgrim.id);
            }
            
            closeModal('pilgrimModal');
            renderPilgrimsList();
            updateDashboardStats();
            showToast('–ü–∞–ª–æ–º–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
            
            // Clear form
            document.querySelectorAll('#pilgrimModal input').forEach(i => i.value = '');
        }

        function saveGroup() {
            const newGroup = {
                id: service_groups.length + 1,
                name: document.getElementById('groupName').value || '–ù–æ–≤–∞—è –≥—Ä—É–ø–ø–∞',
                route: document.getElementById('groupRoute').value || '–ú–æ—Å–∫–≤–∞ - –ú–µ–¥–∏–Ω–∞ - –ú–µ–∫–∫–∞',
                depart_date: document.getElementById('groupDeparture').value || '2025-01-01',
                return_date: document.getElementById('groupReturn').value || '2025-01-15',
                status: 'preparing',
                manager_id: parseInt(document.getElementById('groupManager').value) || 2,
                created_at: new Date().toISOString().split('T')[0],
                pilgrims: []
            };
            
            service_groups.push(newGroup);
            closeModal('groupModal');
            renderGroupsList();
            populateGroupSelects();
            updateDashboardStats();
            showToast('–ì—Ä—É–ø–ø–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!', 'success');
            
            // Clear form
            document.querySelectorAll('#groupModal input').forEach(i => i.value = '');
        }

        // ==================== TEMPLATES ====================
        function renderTemplatesTable() {
            const container = document.getElementById('templatesTable');
            const filteredTemplates = templates.filter(t => {
                if (currentTemplateTab === 'message') return t.type === 'message';
                if (currentTemplateTab === 'document') return t.type === 'document';
                if (currentTemplateTab === 'process') return t.type === 'process';
                return true;
            });
            
            container.innerHTML = filteredTemplates.map(t => `
                <tr>
                    <td><strong>${t.name}</strong></td>
                    <td>${getTemplateTypeBadge(t.type)}</td>
                    <td>${t.trigger_type === 'manual' ? '–í—Ä—É—á–Ω—É—é' : t.trigger_type === 'status_change' ? '–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞' : t.trigger_type === 'time_based' ? '–ü–æ –≤—Ä–µ–º–µ–Ω–∏' : '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞'}</td>
                    <td>${getChannelBadge(t.channel)}</td>
                    <td>${t.is_active ? '<span class="badge badge-success">–ê–∫—Ç–∏–≤–µ–Ω</span>' : '<span class="badge badge-neutral">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>'}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-secondary btn-icon btn-sm" onclick="editTemplate(${t.id})">‚úè</button>
                            <button class="btn btn-secondary btn-icon btn-sm" onclick="previewTemplate(${t.id})">üëÅ</button>
                            <button class="btn btn-danger btn-icon btn-sm" onclick="deleteTemplate(${t.id})">üóë</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function getTemplateTypeBadge(type) {
            const badges = {
                'message': '<span class="badge badge-primary">–°–æ–æ–±—â–µ–Ω–∏–µ</span>',
                'document': '<span class="badge badge-success">–î–æ–∫—É–º–µ–Ω—Ç</span>',
                'process': '<span class="badge badge-warning">–ü—Ä–æ—Ü–µ—Å—Å</span>'
            };
            return badges[type] || '';
        }

        function getChannelBadge(channel) {
            const badges = {
                'whatsapp': '<span class="badge badge-success">WhatsApp</span>',
                'telegram': '<span class="badge badge-primary">Telegram</span>',
                'sms': '<span class="badge badge-secondary">SMS</span>',
                'email': '<span class="badge badge-neutral">Email</span>'
            };
            return badges[channel] || '';
        }

        function switchTab(tab, type) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            currentTemplateTab = type;
            
            const titles = {
                'message': '–®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π',
                'document': '–®–∞–±–ª–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤',
                'process': '–®–∞–±–ª–æ–Ω—ã –ø—Ä–æ—Ü–µ—Å—Å–æ–≤'
            };
            document.getElementById('templatesTitle').textContent = titles[type];
            
            renderTemplatesTable();
        }

        function editTemplate(id) {
            const t = templates.find(t => t.id === id);
            editingTemplateId = id;
            document.getElementById('templateName').value = t.name;
            document.getElementById('templateType').value = t.type;
            document.getElementById('templateTrigger').value = t.trigger_type;
            document.getElementById('templateTriggerKey').value = t.trigger_key;
            document.getElementById('templateChannel').value = t.channel;
            document.getElementById('templateContent').value = t.body;
            openModal('templateModal');
        }

        function deleteTemplate(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —à–∞–±–ª–æ–Ω?')) {
                templates = templates.filter(t => t.id !== id);
                renderTemplatesTable();
                showToast('–®–∞–±–ª–æ–Ω —É–¥–∞–ª—ë–Ω', 'success');
            }
        }

        function saveTemplate() {
            const templateData = {
                name: document.getElementById('templateName').value || '–ù–æ–≤—ã–π —à–∞–±–ª–æ–Ω',
                type: document.getElementById('templateType').value,
                trigger_type: document.getElementById('templateTrigger').value,
                trigger_key: document.getElementById('templateTriggerKey').value,
                channel: document.getElementById('templateChannel').value,
                body: document.getElementById('templateContent').value || '',
                is_active: true,
                created_at: new Date().toISOString().split('T')[0]
            };
            
            if (editingTemplateId) {
                const index = templates.findIndex(t => t.id === editingTemplateId);
                templates[index] = { ...templates[index], ...templateData };
                showToast('–®–∞–±–ª–æ–Ω –æ–±–Ω–æ–≤–ª—ë–Ω', 'success');
            } else {
                templateData.id = templates.length + 1;
                templates.push(templateData);
                showToast('–®–∞–±–ª–æ–Ω —Å–æ–∑–¥–∞–Ω', 'success');
            }
            
            closeModal('templateModal');
            renderTemplatesTable();
        }

        function previewTemplate(id) {
            let template;
            if (id) {
                template = templates.find(t => t.id === id);
            } else {
                template = {
                    body: document.getElementById('templateContent').value
                };
            }
            
            let previewText = template.body;
            previewText = previewText.replace(/\{name\}/g, '–ê—Ö–º–µ–¥');
            previewText = previewText.replace(/\{route\}/g, '–ú–æ—Å–∫–≤–∞ - –ú–µ–¥–∏–Ω–∞ - –ú–µ–∫–∫–∞');
            previewText = previewText.replace(/\{depart_date\}/g, '15.12.2024');
            
            alert('–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —à–∞–±–ª–æ–Ω–∞:\n\n' + previewText);
        }

        function updateTemplateFields() {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–∫—Ä—ã—Ç–∏—è/–ø–æ–∫–∞–∑–∞ –ø–æ–ª–µ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
        }

        // ==================== MANAGERS ====================
        function renderManagersTable() {
            const container = document.getElementById('managersTable');
            const roleFilter = document.getElementById('managerRoleFilter').value;
            
            const filtered = users.filter(u => {
                if (!roleFilter) return true;
                if (roleFilter === 'service') return u.role === 'service';
                if (roleFilter === 'visa') return u.role === 'visa';
                if (roleFilter === 'admin') return u.role === 'admin';
                return true;
            });
            
            container.innerHTML = filtered.map(u => {
                const groupsCount = u.groups_count || service_groups.filter(g => g.manager_id === u.id).length;
                const visasCount = u.visas_count || 0;
                
                return `
                    <tr>
                        <td><strong>${u.name} ${u.lastName}</strong></td>
                        <td>${u.phone}</td>
                        <td>${u.email}</td>
                        <td>${getUserRoleBadge(u.role)}</td>
                        <td>${u.role === 'service' ? groupsCount + ' –≥—Ä—É–ø–ø' : u.role === 'visa' ? visasCount + ' –∑–∞—è–≤–æ–∫' : '‚Äî'}</td>
                        <td>
                            <div class="table-actions">
                                <button class="btn btn-secondary btn-icon btn-sm" onclick="editManager(${u.id})">‚úè</button>
                                ${u.role !== 'admin' ? `<button class="btn btn-danger btn-icon btn-sm" onclick="deleteManager(${u.id})">üóë</button>` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function filterManagers() {
            renderManagersTable();
        }

        function getUserRoleBadge(role) {
            const badges = {
                'admin': '<span class="badge badge-neutral">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>',
                'service': '<span class="badge badge-primary">–°–µ—Ä–≤–∏—Å –º–µ–Ω–µ–¥–∂–µ—Ä</span>',
                'visa': '<span class="badge badge-success">–í–∏–∑–∞ –º–µ–Ω–µ–¥–∂–µ—Ä</span>'
            };
            return badges[role] || '';
        }

        function editManager(id) {
            const u = users.find(u => u.id === id);
            editingManagerId = id;
            document.getElementById('managerModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞';
            document.getElementById('managerName').value = u.name;
            document.getElementById('managerLastName').value = u.lastName;
            document.getElementById('managerPhone').value = u.phone;
            document.getElementById('managerEmail').value = u.email;
            document.getElementById('managerRole').value = u.role;
            document.getElementById('managerLanguage').value = u.language || 'ru';
            openModal('managerModal');
        }

        function deleteManager(id) {
            const user = users.find(u => u.id === id);
            if (user && user.role === 'admin') {
                showToast('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å', 'error');
                return;
            }
            
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞?')) {
                users = users.filter(u => u.id !== id);
                renderManagersTable();
                populateManagerSelects();
                showToast('–ú–µ–Ω–µ–¥–∂–µ—Ä —É–¥–∞–ª—ë–Ω', 'success');
            }
        }

        function saveManager() {
            const managerData = {
                name: document.getElementById('managerName').value || '–ù–æ–≤—ã–π',
                lastName: document.getElementById('managerLastName').value || '–ú–µ–Ω–µ–¥–∂–µ—Ä',
                phone: document.getElementById('managerPhone').value || '+7 999 000-00-00',
                email: document.getElementById('managerEmail').value || 'manager@atlas.com',
                role: document.getElementById('managerRole').value,
                language: document.getElementById('managerLanguage').value || 'ru',
                created_at: new Date().toISOString().split('T')[0]
            };
            
            if (editingManagerId) {
                const index = users.findIndex(u => u.id === editingManagerId);
                users[index] = { ...users[index], ...managerData };
                showToast('–î–∞–Ω–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
            } else {
                managerData.id = users.length + 1;
                users.push(managerData);
                showToast('–ú–µ–Ω–µ–¥–∂–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
            }
            
            closeModal('managerModal');
            renderManagersTable();
            populateManagerSelects();
        }

        // ==================== SCHEDULE ====================
        function renderCalendar() {
            const container = document.getElementById('calendarGrid');
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', 
                               '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            const weekdays = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            let html = weekdays.map(d => `<div class="calendar-weekday">${d}</div>`).join('');
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            let startDay = firstDay.getDay() || 7;
            
            // Previous month days
            for (let i = startDay - 1; i > 0; i--) {
                const d = new Date(year, month, 1 - i);
                html += `<div class="calendar-day other-month"><span class="calendar-day-number">${d.getDate()}</span></div>`;
            }
            
            // Current month days
            const today = new Date();
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                const dayEvents = calendar_events.filter(e => e.date === dateStr);
                const isToday = today.getFullYear() === year && today.getMonth() === month && today.getDate() === i;
                
                html += `
                    <div class="calendar-day ${isToday ? 'today' : ''}" onclick="showDayEvents('${dateStr}')">
                        <span class="calendar-day-number">${i}</span>
                        <div class="calendar-events">
                            ${dayEvents.map(e => `<div class="calendar-event ${e.type}">${e.name}</div>`).join('')}
                        </div>
                    </div>
                `;
            }
            
            // Next month days
            const remaining = 42 - (startDay - 1 + lastDay.getDate());
            for (let i = 1; i <= remaining && remaining < 14; i++) {
                html += `<div class="calendar-day other-month"><span class="calendar-day-number">${i}</span></div>`;
            }
            
            container.innerHTML = html;
        }

        function changeMonth(delta) {
            currentMonth.setMonth(currentMonth.getMonth() + delta);
            renderCalendar();
        }

        function showDayEvents(dateStr) {
            const dayEvents = calendar_events.filter(e => e.date === dateStr);
            if (dayEvents.length > 0) {
                const eventList = dayEvents.map(e => {
                    const groups = service_groups.filter(g => e.group_ids.includes(g.id));
                    const groupNames = groups.map(g => g.name).join(', ');
                    return `‚Ä¢ ${e.name} (${e.time}) ‚Äî ${groupNames || '–ì—Ä—É–ø–ø–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'}`;
                }).join('\n');
                alert(`–°–æ–±—ã—Ç–∏—è –Ω–∞ ${formatDate(dateStr)}:\n\n${eventList}`);
            } else {
                alert(`–ù–∞ ${formatDate(dateStr)} –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π.`);
            }
        }

        function renderUpcomingDepartures() {
            const container = document.getElementById('upcomingDeparturesTable');
            const upcomingGroups = service_groups.filter(g => new Date(g.depart_date) > new Date());
            
            container.innerHTML = upcomingGroups.map(group => `
                <tr>
                    <td><strong>${group.name}</strong></td>
                    <td>${formatDate(group.depart_date)}</td>
                    <td>${formatDate(group.return_date)}</td>
                    <td>${group.pilgrims ? group.pilgrims.length : 0}</td>
                    <td><span class="badge badge-${group.status}">${group.status}</span></td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-secondary btn-sm" onclick="selectGroup(${group.id})">–û—Ç–∫—Ä—ã—Ç—å</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function saveEvent() {
            const groupSelect = document.getElementById('eventGroup');
            const selectedGroups = Array.from(groupSelect.selectedOptions).map(option => parseInt(option.value));
            
            const newEvent = {
                id: calendar_events.length + 1,
                name: document.getElementById('eventName').value || '–ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ',
                type: document.getElementById('eventType').value,
                date: document.getElementById('eventDate').value,
                time: document.getElementById('eventTime').value || '12:00',
                group_ids: selectedGroups,
                note: document.getElementById('eventNote').value || ''
            };
            
            calendar_events.push(newEvent);
            closeModal('eventModal');
            renderCalendar();
            showToast('–°–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–æ', 'success');
            
            document.querySelectorAll('#eventModal input, #eventModal textarea').forEach(i => i.value = '');
        }

        // ==================== SETTINGS ====================
        function testOCRConnection() {
            showToast('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ OCR...', 'info');
            setTimeout(() => {
                showToast('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ OCR —É—Å–ø–µ—à–Ω–æ!', 'success');
            }, 1500);
        }

        function sendTestEmail() {
            showToast('–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∏—Å—å–º–∞...', 'info');
            setTimeout(() => {
                showToast('–¢–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (—Å–∏–º—É–ª—è—Ü–∏—è)', 'success');
            }, 1500);
        }

        function saveSettings() {
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ OCR
            system_settings.ocr.api_key = document.getElementById('ocrApiKey').value;
            system_settings.ocr.endpoint = document.getElementById('ocrEndpoint').value;
            system_settings.ocr.language = document.getElementById('ocrLanguage').value;
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ SMTP
            system_settings.smtp.host = document.getElementById('smtpHost').value;
            system_settings.smtp.port = document.getElementById('smtpPort').value;
            system_settings.smtp.login = document.getElementById('smtpLogin').value;
            system_settings.smtp.password = document.getElementById('smtpPassword').value;
            system_settings.smtp.from = document.getElementById('smtpFrom').value;
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤
            system_settings.messengers.whatsapp_api_key = document.getElementById('whatsappApiKey').value;
            system_settings.messengers.whatsapp_endpoint = document.getElementById('whatsappEndpoint').value;
            system_settings.messengers.telegram_token = document.getElementById('telegramToken').value;
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            system_settings.security.min_password_length = parseInt(document.getElementById('minPasswordLength').value) || 8;
            system_settings.security.require_2fa = document.getElementById('require2FA').checked;
            system_settings.security.enable_audit_log = document.getElementById('enableAuditLog').checked;
            
            showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫...', 'info');
            setTimeout(() => {
                showToast('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
            }, 1500);
        }

        // ==================== HELPER FUNCTIONS ====================
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }

        function populateGroupSelects() {
            const selects = ['pilgrimGroup', 'eventGroup', 'groupManager'];
            selects.forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    if (id === 'eventGroup') {
                        select.innerHTML = service_groups.map(g => `<option value="${g.id}">${g.name}</option>`).join('');
                        select.multiple = true;
                    } else {
                        const serviceManagers = users.filter(u => u.role === 'service');
                        if (id === 'groupManager') {
                            select.innerHTML = serviceManagers.map(m => `<option value="${m.id}">${m.name} ${m.lastName}</option>`).join('');
                        } else {
                            select.innerHTML = service_groups.map(g => `<option value="${g.id}">${g.name}</option>`).join('');
                        }
                    }
                }
            });
        }

        function populateManagerSelects() {
            const select = document.getElementById('groupManager');
            if (select) {
                const serviceManagers = users.filter(u => u.role === 'service');
                select.innerHTML = serviceManagers.map(m => `<option value="${m.id}">${m.name} ${m.lastName}</option>`).join('');
            }
        }
    </script>
</body>
</html>